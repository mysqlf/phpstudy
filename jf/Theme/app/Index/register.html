[include file='Inc/header'/]
<body ondragstart="return false;" onselectstart="return false;" oncontextmenu="return false" onselectstart="return false"
      ondragstart="return false" onbeforecopy="return false" oncopy=document.selection.empty() onselect=document.selection.empty()>
<style>
    .hqyzm{
        width: 40%;text-align: center;background-color: #3879D9;display: inline-block;height: 28px;line-height: 28px;margin-left:9%;border-radius:4px;color: white;
    }
    .ccc{
        background: #c0c0c0;
    }
</style>
<div id="page">
    <div class="banners">
        <span class="left_menu">注册会员</span>
        <span class="right_menu"><a href="{:U('Index/category')}"><i class="icon-reorder"></i></a></span>
    </div>
    <div id="content">
        <div class="info_head info_light">
            <div style="clear:both;height:0px;"></div>
            <form id="myform1" class="form-horizontal" action="#" method="post" accept-charset="utf-8">
                <div class="form-group">
                    <label class="col-sm-2 control-label">用户名：</label>
                    <div class="col-sm-10">
                        <input type="text" name="username" class="form-control" datatype="*" nullmsg="用户名不能为空">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">手机号码：</label>
                    <div class="col-sm-10">
                        <input type="text" name="phone" class="form-control" datatype="m" errormsg="手机号码不正确" >
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">验证码：</label>
                    <div class="col-sm-10">
                        <input type="text" id="yzm"  class="form-control" style="width: 50%"><span class="hqyzm">获取验证码</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">姓名：</label>
                    <div class="col-sm-10">
                        <input type="text" name="name" class="form-control" datatype="/^[\u4e00-\u9fa5]{2,4}$/" errormsg="姓名不正确">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">性别：</label>
                    <div class="col-sm-10" style="display: inline-block">
                        <span class="formtext">男 <input type="radio" name="sex" value="男">　女 <input type="radio" name="sex" value="女"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">年龄：</label>
                    <div class="col-sm-10">
                        <input type="text" name="age" class="form-control" datatype="n1-2" errormsg="年龄不正确">
                    </div>
                </div>
                <!--<div class="form-group">-->
                <!--<label class="col-sm-2 control-label">手机号码：</label>-->
                <!--<div class="col-sm-10">-->
                <!--<input type="text" name="phone" class="form-control" datatype="m" errormsg="手机号码不正确">-->
                <!--</div>-->
                <!--</div>-->
                <div class="form-group">
                    <label class="col-sm-2 control-label">身份证号</label>
                    <div class="col-sm-10">
                        <input type="text" name="idcard" class="form-control" errormsg="身份证号输入不正确" datatype="/^(\d{15}$|^\d{18}$|^\d{17}(\d|X|x))$/">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">邮寄地址：</label>
                    <div class="col-sm-10">
                        <input type="text" name="address" class="form-control" nullmsg="请填写邮寄地址" datatype="*">
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputPassword3" class="col-sm-2 control-label">登录密码：</label>
                    <div class="col-sm-10">
                        <input type="password" name="password" class="form-control" datatype="*6-16" nullmsg="请设置密码" errormsg="密码长度在6~16位之间">
                    </div>
                </div>
                <div class="form-group">
                    <label for="inputPassword3" class="col-sm-2 control-label">确认密码：</label>
                    <div class="col-sm-10">
                        <input type="password" name="password2" class="form-control" datatype="*" recheck="password" nullmsg="请再输入一次密码" errormsg="您两次输入的账号密码不一致">
                    </div>
                </div>
                <div style="clear: both;height: 20px;"></div>
                <div class="form-group">
                    <div class="col-sm-offset-2 col-sm-10">
                        <button type="submit" class="btn btn-success" id="zc">立即注册</button>
                    </div>
                </div>
                <input type="text" name="score" value="200" style="display: none;">
            </form>
        </div>
        <div style="padding:15px;"></div>
    </div>
    <script>
        var tmps=window.location.search;
        tmps=tmps.replace('?');
        tmps=tmps.split('=');
        $('input[name=score]').val(200+Number(tmps[3]));
        var yzm={};
        $.fn.mask = function () {
            var divHtml = '<div class="divMask" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px; background: #fff; opacity: 0; filter: alpha(opacity=0)"> </div>';
            $(this).wrap('<span style="position: relative"></span>');
            $(this).parent().append(divHtml);
            $(this).data("mask","true");
        }
        //取消屏蔽
        $.fn.unmask = function () {
            $(this).parent().find(".divMask").remove();
            $(this).unwrap();
            $(this).data("mask", "false");
        }
        $(function(){
            var t;
            $('.hqyzm').click(function(){
                var phone=$('input[name=phone]').val();
                if(phone==''){
                    alert('请输入手机号');
                    return;
                }
                var s=1;
                var that=this;
                if(typeof t=='function'){
                    clearInterval(t);
                }
                t=setInterval(function(){
                    $(that).text((60-s)+'秒后再发送');
                    $(that).addClass('ccc');
                    $(that).mask("disabled");
                    s++;
                    if(s>60){
                        $(that).removeClass('ccc');
                        $(that).unmask("disabled");
                        clearInterval(t);
                        $(that).text('获取验证码');
                    }
                },1000)
                $.ajax({
                    "dataType": 'jsonP',
                    "type": "POST",
                    "url": "http://192.168.199.219:8098/coupon/coupon/backvcode.htm",
                    "data": {usermobile: phone},
                    "jsonp":'jsonpCallback',
                    "cache": false,
                    "success": function (data) {
                        var tmp=eval(data);
                        if(tmp.msg){
                            alert(tmp.msg);
                            $(that).removeClass('ccc');
                            $(that).unmask("disabled");
                            clearInterval(t);
                            $(that).text('获取验证码');
                        }else{
                            yzm.yzm=tmp.vcode;
                        }
                    }
                })

            })
            $('input[name=phone]').change(function(){
                var val=$.trim($(this).val());
                var reg= /^(1[3|5|8][0-9]|14[5|7]|17[6|7|8])\d{8}$/;
                if(!reg.test(val)){
                     alert('手机号有误');
                     return;
                }
            })
            $('#yzm').change(function(){
                if($(this).val()!=yzm.yzm){
                    $('#zc').mask();
                    alert('验证码输入有误,请重新输入!');
                }else{
                    $('#zc').unmask();
                }
            })
        })
    </script>
    [include file='Inc/footer'/]