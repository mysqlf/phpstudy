<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">
  <meta name="format-detection" content="telephone=no" >
  <title>智通通行证更改密码</title>
  <link rel="stylesheet" href="Assets/Home/styles/screen.css">
</head>
<body class="login">
	   <i class="icon-logo"></i>
	   <div id="login_box">
	        <form action="<?php echo U('Homemaking-changePassword','','');?>" method="post">
	        	<if condition="($u eq null) OR ($p eq null)">
			        <div class="relative_box">
			       	 <label for="tel_email">手机号：</label><input type="text" id="account" class="username_text" name="account" placeholder="手机" required maxlength="11">
			        </div> 
				    <div class="relative_box">
				      <label for="password">旧密码：</label> <input type="password" id="oldPassword" class="pw_text" name="oldPassword" placeholder="请输入旧密码" required>
				    </div> 
			    <else/>
				    <div class="relative_box">
			       	 <label for="tel_email">手机号：</label><input type="text" id="account" class="username_text" name="account" placeholder="手机" required maxlength="11" value="{$u}" readonly>
			        </div> 
				    <div class="relative_box">
				      <label for="password">旧密码：</label> <input type="password" id="oldPassword" class="pw_text" name="oldPassword" placeholder="请输入旧密码" required value="{$p}" >
				    </div> 
			    </if>
			    <div class="relative_box"> 
			      <label for="password">新密码：</label> <input type="password" id="newPassword" class="pw_text" name="newPassword" placeholder="请输入新密码" maxlength="20" required>
			   </div>
			   <div class="relative_box">
			      <label for="password">确认密码：</label> <input type="password" id="ensurePassword" class="pw_text" name="ensurePassword" placeholder="请再次输入新密码" required>
			   </div>
	    
		   	   <a href="FindPassword-getpassword?redirect={$redirect}" class="forget_pw fr">忘记密码?</a>
		   	   <input type="submit" value="更改密码" class="commen_btn" disabled>
	           <input type="hidden" name="redirect" value="{$lasturl}" />
	   	   </form>
	      <!--  <span class="login_other fr">还没有账号？<a href="Account-index?redirect={$redirect}" class="register">立即注册</a></span> -->
	       <div class="clear"></div>
	   </div>
	   <footer id="login_foot">
	     	<dt>一个账号即可登录智通旗下所有的产品和服务：</dt>
	     	<dd>智通人才网</dd>
	     	<dd>校校招</dd>
	     	<dd>上班趣</dd>
	     	<dd>智通到家</dd>
	     	<dd>奔职</dd>
	   </footer>
 <script src="/Assets/Home/scripts/lib/sea.js"></script>
 <script>
     seajs.use(['/Assets/Home/scripts/lib/jquery','/Assets/Home/scripts/plug/jquery.validate.min'],function($){
     	         $('form input[type="submit"]').prop('disabled',false);
                 var formValidate=$("form").validate({
                 	   submitHandler : function(form){

                 	   	$.ajax({
                 	   		 url: 'Homemaking-changePassword',  
		                     type: "post",       
		                     dataType: "json",      
		                     data: {   
                                'password' :  $("#oldPassword").val(),
                                'phone' :  $("#account").val()
		                     } ,
		                     success : function(ret){
		                     	if(ret == 'true'){
		                     		form.submit();
		                     	} else{
		                     		formValidate.showErrors({
						              oldPassword : '密码不正确'
						            })
		                     	}
		                     }  
		                   })    
                 	   },
				       rules : {
				       	 account : {
				       	 	required : true,
				       	 	istelephone : true
				       	 },
				         oldPassword : {
		                    required : true,
		                    
				          },
				         newPassword : {
				         	required : true,
				         	password : true,
				         	minlength : 6 ,
				         	maxlength : 20
				         },
				         ensurePassword : {
				         	required : true,
				         	equalTo : '#newPassword'
				         }           
				       },
				       messages : {
				          oldPassword : {
				            required:'请输入密码'
				          },
				          account : {
				          	required:'请输入手机号',
				          	maxlength : '请输入11位手机号',
				          	istelephone : '请输入正确的手机号码'
				          },
				          newPassword : {
				          	required:'请输入新密码',
				          	password : '只能输入数字、字母或字符',
				          	minlength : '密码长度不能少于6位',
				          	maxlength : '密码长度不能大于于20位',
				          },
				          ensurePassword : {
				          	required:'请再次输入新密码',
				          	equalTo : '两次新密码不一致'
				          }  

				       } 
				    });
     });
 </script>	   
</body>
</html>