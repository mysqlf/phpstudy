<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
	<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
	<title>订制服务</title>
	<link rel="stylesheet" type="text/css" href="/Assets/Home/css/common.min.css">
</head>

<body id="regist" onload="">
	<div id="main" style="text-align:center;">
		<H1>广告页面</H1>
		<br />
		<font></font>
	</div>
	<section id="reg-wrap">
    <form id="reg-form" class="reg-form" action="Homemaking-mamabang_issue" method="post">
        <div class="form-bg">
           <div class="clearfix">
           	<div class="base-horizontal  col-xs-9">
                <input id="content"  type="textarea" name="content" placeholder="请输入内容"  required >
                <span class="del-input-txt icon-sprite"></span>
           	</div>
           	<div class="base-horizontal  col-xs-3">
                <input id="x-btn" type="submit" value="发布"/>
           	</div>
           </div>
            </div>
        <input type="hidden" name="redirect" value="{$lasturl}" />
        <input id="time" type="hidden" value="{$time}" />
      <!--<input id="submit-btn" type="submit" value="提交"/>-->
      <!--<p class="text-center" style="color:#666;padding: 5px 12px;">企业将会通过您<span class="c-brand">验证</span>过的<span class="c-brand">手机号码</span>，给您发送<span class="c-brand">录取通知</span>，请先完成验证，再报名。</p>-->
    </form>
 </section>

<div class="form-bg">
    <volist name="list" id="vo">
           <div class="clearfix">
           	<div class="base-horizontal  col-xs-3">
           		<img src="{$vo.fldPhotoUrl}"/>
           		{$vo.fldName}
           	</div>
           	<div class="base-horizontal  col-xs-3">
           		证件：
           		<if condition="($vo.homemaking_certificate eq null) and $vo.fldSign eq 0">
           			未设置
				 <else /> 
				 	<if condition="$fldSign eq 1">
           				身份已验证
           			</if>
				 	<if condition="$vo.homemaking_certificate neq null">
           				<volist name="vo.homemaking_certificate" id="voo">{$voo}&#160;</volist>
           			</if>
				 </if>
           		
           	</div>
           	<div class="base-horizontal  col-xs-2">
           		年龄：
           			<if condition="$vo.fldage eq null">
           				未设置
           			<else/>
           				{$vo.fldage} 
           			</if>
           		籍贯：
           			<if condition="$vo.fldNative eq null">
           				未设置
           			<else/>
           				{$vo.fldNative} 
           			</if>
           	</div>
           	<div class="base-horizontal  col-xs-2">
           		级别：
           			<if condition="$vo.homeInfoSignGrade eq null">
           				未定级
           			<else/>
           				{$vo.homeInfoSignGrade} 
           			</if>
           		学历：
           			<if condition="$vo.fldEducation eq null">
           				未设置
           			<else/>
           				{$vo.fldEducation} 
           			</if>
           	</div>
           	<div class="base-horizontal  col-xs-2">
           		语言能力：
           			<if condition="$vo.fldLanguage eq null">
           				未设置
           			<else/>
           				{$vo.fldLanguage} 
           			</if>
           		点评（{$vo.homemakingServiceCommentNum}）
           	</div>
           </div>
    </volist>
 </div>


 <script src="/Assets/Home/js/lib/sea.js" type="text/javascript"></script>

 <script type="text/javascript">

   seajs.use(['zepto/zepto.min','./Assets/Home/js/plug/h5Validate/html5Validate.min','/Assets/Home/js/plug/layer.m/layer.m'],function($,validate,layer){
   $(function(){
     validate($);


       $('#reg-form').html5Validate(function(){
           layer.open({
               content: '<img width="30" style="position:relative;top:8px;" src="/Assets/Home/images/loading.gif">数据提交中...',
               shadeClose: false
           });
           setTimeout(function(){
               layer.open({
                   content: '服务器繁忙，请重试',
                   shadeClose: false,
                   time : 2
               });
           },60000);
           this.submit();
       this.submit();
     },{
      validate : function(){
        var $phone = $('#phone');
        var phoneVal = $phone.val();
        var $code = $('#code');
        var codeVal = $code.val();
        var numReg = /^\d+$/;       
        var isReg = $phone.data('isReg');
        if(isReg != 'true' && $.html5Validate.isAllpass($phone)){
          var flag = true;
          $.ajax({
             type:'post',
             async:false,
             url : "Account-mobile",
              data:{'phoneVal':phoneVal},
              timeout : 60000,
              error : function(){
                var index = layer.open({
                  content : '<p class="text-center">服务器繁忙</p>'
                });
                setTimeout(function(){
                  layer.close(index)
                },1000)

              },
             success:function(ret){
               if(ret == 'false'){             
                   flag = false;
               }

             }
           });
             if(!flag){
              $phone.testRemind('用户已存在');
              return false;
            } 
            else{
              $phone.data('isReg','true');
            }
        }
        if(codeVal.length < 6){
          $code.testRemind('只能输入6位数字');
          return false;

        } else if(numReg.test(codeVal)){
           var flag = true;
           $.ajax({
             type:'post',
             async:false,
             url : "Account-code",
             data:{'codeVal':codeVal,'phoneVal':phoneVal},
             timeout : 60000,
             error : function(){
                var index = layer.open({
                  content : '<p class="text-center">服务器繁忙</p>'
                });
                setTimeout(function(){
                  layer.close(index)
                },1000)

              },
             success:function(ret){
               if(ret == 'false'){             
                   flag = false;
               }

             }
            
           });
            if(!flag){
              $code.testRemind('验证码不正确');
              return false;
            } 
        } 
        else{
          $code.testRemind('验证码只能为数字');
          return false;
        }

        return true;
      }

     })
   
     
       var time =  parseInt($('#time').val());
       var timer = null;
         if(time){
             var $codeBtn = $('#get-code');
             $codeBtn.data('disabled','true');
             countTime($codeBtn,time);
             timer = setInterval(function(){

                 countTime($codeBtn);
             },1000)

         }
         else{
             time = 59;
         }

         function countTime(obj){
                 if(time == 0){
                     clearTimeout(timer);
                     time = 59;
                     obj.html('重新发送');
                     obj.data('disabled','false');
                 }
                 else{
                     obj.html('('+time + 's）后重发');
                     time--;
                 }
         }
       $('#get-code').on('tap click',function(){

            var $this = $(this);
            var $phone = $('#phone');
            var phoneVal = $phone.val();
             var $time = $('#time');
             var time =parseInt($time.val());

            if($.html5Validate.isAllpass($phone)){
                if($this.data('disabled') == 'true'){
                  return;

                } 
                $this.data('disabled','true');
                $.ajax({
                     type : 'post',
                     url : 'Account-getcode',
                     data:{'phoneVal':phoneVal},
                     timeout : 60000,
                     error : function(){
                        var index = layer.open({
                          content : '<p class="text-center">服务器繁忙</p>'
                        });
                        setTimeout(function(){
                          layer.close(index)
                        },1000)

                      },
                     success : function(ret){
                         if (!ret)
                         {
                             alert("发送失败")
                             return;
                         }

                       timer = setInterval(function(){
                           countTime($this);
                       },1000)
                       
                     }

                       });

            }        

       })
       $('#phone').on('keyup',function(){
          var $this = $(this);
          var $parent = $this.parent();
          var $del =  $parent.find('.del-input-txt');
          var val = $this.val();
          $this.data('isReg','false');
          if(val != ''){
            $del.addClass('active');
          }
          else{
            $del.removeClass('active');
          }
       })
       $('.del-input-txt').on('tap',function(){
          var $this = $(this);
          var $parent = $this.parent();
          var $input =  $parent.find('input');
          $input.val('');
          $this.removeClass('active');
       });
       $('.show-psw').on('tap',function(){
          var $this = $(this);
          var $parent = $this.parent();
          var $input =  $parent.find('input');
          var type =  $input.attr('type');

          if(type == 'password'){
            $input.attr('type','text');
            $this.addClass('active');
          }
          else{
            $input.attr('type','password');
            $this.removeClass('active');
          }

       })

     })
 
   });
 </script>
</body>

</html>
