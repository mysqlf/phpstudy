define(function(){return function(){!function(a){DBC2SBC=function(a){var b,c,d="";for(b=0;b<a.length;b++)c=a.charCodeAt(b),d+=c>=65281&&65373>=c?String.fromCharCode(a.charCodeAt(b)-65248):12288==c?String.fromCharCode(a.charCodeAt(b)-12288+32):a.charAt(b);return d},a.testRemind=function(){var b=a(window).width(),c=function(b){b&&b.target&&b.target.id!==a.testRemind.id&&0===a(b.target).parents("#"+a.testRemind.id).length&&a.testRemind.hide()},d=function(b){b&&b.target&&"body"!==b.target.tagName.toLowerCase()&&a.testRemind.hide()},e=function(){if(a.testRemind.display){var c=a(window).width();Math.abs(b-c)>20&&(a.testRemind.hide(),b=c)}};return{id:"validateRemind",display:!1,css:{},hide:function(){a("#"+this.id).remove(),this.display=!1,a(document).unbind({mousedown:c,keydown:d}),a(window).unbind("resize",e)},bind:function(){a(document).bind({mousedown:c,keydown:d}),a(window).bind("resize",e)}}}(),OBJREG={EMAIL:"^[a-z0-9._%-]+@([a-z0-9-]+\\.)+[a-z]{2,4}$",NUMBER:"^\\-?\\d+(\\.\\d+)?$",URL:"^(http|https|ftp)\\:\\/\\/[a-z0-9\\-\\.]+\\.[a-z]{2,3}(:[a-z0-9]*)?\\/?([a-z0-9\\-\\._\\?\\,\\'\\/\\\\\\+&amp;%\\$#\\=~])*$",MOBILE:"^((1[3-8][0-9])+\\d{8})$",TEL:"^((\\+?[0-9]{2,4}\\-[0-9]{3,4}\\-)|([0-9]{3,4}\\-))?([0-9]{7,8})(\\-[0-9]+)?$",QQ:"^[1-9]\\d{4,9}$",ZIPCODE:"^\\d{6}$",prompt:{radio:"请选择一个选项",checkbox:"如果要继续，请选中此框",select:"请选择列表中的一项",email:"请输入正确的电子邮件地址",url:"请输入正确的网站地址",tel:"请输入正确的电话号码",mobile:"请输入正确的手机号码",qq:"请输入正确的QQ号",zipcode:"请输入正确的邮编",number:"请输入数值",date:"请输入日期",pattern:"内容格式不符合要求",empty:"请填写此字段",multiple:"多条数据使用逗号分隔"}},a.html5Attr=function(b,c){if(!b||!c)return void 0;if(document.querySelector)return a(b).attr(c);var d;return d=b.getAttributeNode(c),d&&""!==d.nodeValue?d.nodeValue:void 0},a.html5Validate=function(){return{isSupport:function(){return"email"===a('<input type="email">').attr("type")}(),isEmpty:function(b,c){c=c||a.html5Attr(b,"placeholder");var d=b.value;return"password"!==b.type&&(d=a.trim(d)),""===d||d===c?!0:!1},isRegex:function(b,c,d){var e=b.value,f=e,g=b.getAttribute("type")+"";if(g=g.replace(/\W+$/,""),"password"!==g&&(f=DBC2SBC(a.trim(e)),f!==e&&a(b).val(f)),c=c||function(){return a.html5Attr(b,"pattern")}()||function(){return g&&a.map(g.split("|"),function(a){var b=OBJREG[a.toUpperCase()];return b?b:void 0}).join("|")}(),""===f||!c)return!0;var h=a(b).hasProp("multiple"),i=new RegExp(c,d||"i");if(h&&!/^number|range$/i.test(g)){var j=!0;return a.each(f.split(","),function(b,c){c=a.trim(c),j&&!i.test(c)&&(j=!1)}),j}return i.test(f)},isOverflow:function(b){if(!b)return!1;var c,d,e,f=a(b).attr("min"),g=a(b).attr("max"),h=b.value;if(f||g){if(h=Number(h),c=Number(a(b).attr("step"))||1,f&&f>h)a(b).testRemind("值必须大于或等于"+f);else if(g&&h>g)a(b).testRemind("值必须小于或等于"+g);else{if(!c||/^\d+$/.test(Math.abs(h-f||0)/c))return!1;a(b).testRemind("值无效")}b.focus(),b.select()}else if(d=a(b).attr("data-min"),e=a(b).attr("data-max"),d&&h.length<d)a(b).testRemind("至少输入"+d+"个字符"),b.focus();else{if(!(e&&h.length>e))return!1;a(b).testRemind("最多输入"+e+"个字符"),a(b).selectRange(e,h.length)}return!0},isAllpass:function(b,c){if(!b)return!0;var d={labelDrive:!0};params=a.extend({},d,c||{}),b.size&&1==b.size()&&"form"==b.get(0).tagName.toLowerCase()?b=b.find("input,select,textarea"):b.tagName&&"form"==b.tagName.toLowerCase()&&(b=a(b).find("input,select,textarea"));var e=this,f=!0,g=function(b,c,d){var e,f=a(b).attr("data-key"),g=a("label[for='"+b.id+"']"),h="";if(params.labelDrive&&(e=a.html5Attr(b,"placeholder"),g.each(function(){var b=a(this).text();b!==e&&(h+=b.replace(/\*|:|：/g,""))})),a(b).isVisible())if("radio"==c||"checkbox"==c)a(b).testRemind(OBJREG.prompt[c],{align:"left"}),b.focus();else if("select"==d||"empty"==d)a(b).testRemind("empty"==d&&h?"您尚未输入"+h:OBJREG.prompt[d]),b.focus();else if(/^range|number$/i.test(c)&&Number(b.value))a(b).testRemind("值无效"),b.focus(),b.select();else{var i=OBJREG.prompt[c]||OBJREG.prompt.pattern;h&&(i="您输入的"+h+"格式不准确"),"number"!=c&&a(b).hasProp("multiple")&&(i+="，"+OBJREG.prompt.multiple),a(b).testRemind(i),b.focus(),b.select()}else{var j=a(b).attr("data-target"),k=a("#"+j);0==k.size()&&(k=a("."+j));var l="您尚未"+(f||("empty"==d?"输入":"选择"))+(!/^radio|checkbox$/i.test(c)&&h||"该项内容");k.size()?(k.offset().top<a(window).scrollTop()&&a(window).scrollTop(k.offset().top-50),k.testRemind(l)):alert(l)}return!1};return b.each(function(){var b=this,c=b.getAttribute("type"),d=b.tagName.toLowerCase(),h=a(this).hasProp("required");if(c){var i=c.replace(/\W+$/,"");if(!params.hasTypeNormally&&a.html5Validate.isSupport&&c!=i)try{b.type=i}catch(j){}c=i}if(0!=f&&!b.disabled&&"submit"!=c&&"reset"!=c&&"file"!=c&&"image"!=c)if("radio"==c&&h){var k=a(b.name?"input[type='radio'][name='"+b.name+"']":b),l=!1;k.each(function(){0==l&&a(this).is(":checked")&&(l=!0)}),0==l&&(f=g(k.get(0),c,d))}else"checkbox"==c&&h&&!a(b).is(":checked")?f=g(b,c,d):"select"==d&&h&&!b.value?f=g(b,c,d):h&&e.isEmpty(b)||!(f=e.isRegex(b))?(f?g(b,c,"empty"):g(b,c,d),f=!1):e.isOverflow(b)&&(f=!1)}),f}}}(),a.fn.isVisible=function(){return"hidden"!==a(this).attr("type")&&"none"!==a(this).css("display")&&"hidden"!==a(this).css("visibility")},a.fn.hasProp=function(b){if("string"!=typeof b)return void 0;var c=!1;if(document.querySelector){var d=a(this).attr(b);void 0!==d&&d!==!1&&(c=!0)}else{var e=a(this).get(0).outerHTML,f=e.slice(0,e.search(/\/?['"]?>(?![^<]*<['"])/));c=new RegExp("\\s"+b+"\\b","i").test(f)}return c},a.fn.selectRange=function(b,c){var d=a(this).get(0);if(d.createTextRange){var e=d.createTextRange();e.collapse(!0),e.moveEnd("character",c),e.moveStart("character",b),e.select()}else d.focus(),d.setSelectionRange(b,c);return this},a.fn.testRemind=function(b,c){var d={size:6,align:"center",css:{maxWidth:280,backgroundColor:"#FFFFE0",borderColor:"#F7CE39",color:"#333",fontSize:"14px",padding:"6px 10px",zIndex:1001}};c=c||{},c.css=a.extend({},d.css,c.css||a.testRemind.css);var e=a.extend({},d,c||{});if(b&&a(this).isVisible()){var f={center:"50%",left:"15%",right:"85%"},g=f[e.align]||"50%";e.css.position="absolute",e.css.top="-99px",e.css.border="1px solid "+e.css.borderColor,a("#"+a.testRemind.id).size()&&a.testRemind.hide(),this.remind=a('<div id="'+a.testRemind.id+'">'+b+"</div>").css(e.css),a(document.body).append(this.remind);var h;!window.XMLHttpRequest&&(h=parseInt(e.css.maxWidth))&&this.remind.width()>h&&this.remind.width(h);var i=a(this).offset(),j="top";if(!i)return a(this);var k=i.top-this.remind.height()-e.size;k<a(document).scrollTop()&&(j="bottom",k=i.top+a(this).height()+e.size);var l=function(b){var c="transparent",d="dashed",f="solid",g={},h={width:0,height:0,overflow:"hidden",borderWidth:e.size+"px",position:"absolute"},i={};if("before"===b)g={top:{borderColor:[e.css.borderColor,c,c,c].join(" "),borderStyle:[f,d,d,d].join(" "),top:0},bottom:{borderColor:[c,c,e.css.borderColor,""].join(" "),borderStyle:[d,d,f,d].join(" "),bottom:0}};else{if("after"!==b)return g=null,h=null,i=null,null;g={top:{borderColor:e.css.backgroundColor+["",c,c,c].join(" "),borderStyle:[f,d,d,d].join(" "),top:-1},bottom:{borderColor:[c,c,e.css.backgroundColor,""].join(" "),borderStyle:[d,d,f,d].join(" "),bottom:-1}}}return i=a.extend({},g[j],h),a("<"+b+"></"+b+">").css(i)},m={width:2*e.size,left:g,marginLeft:-1*e.size+"px",height:e.size,textIndent:0,overflow:"hidden",position:"absolute"};return"top"==j?m.bottom=-1*e.size:m.top=-1*e.size,this.remind.css({left:i.left,top:k,marginLeft:.5*a(this).width()-this.remind.width()*parseInt(g)/100}).prepend(a("<div></div>").css(m).append(l("before")).append(l("after"))),a.testRemind.display=!0,a.testRemind.bind(),a(this)}},a.fn.html5Validate=function(b,c){var d={novalidate:!0,submitEnabled:!0,validate:function(){return!0}},e=a.extend({},d,c||{}),f=a(this).find("input,select,textarea");return a.html5Validate.isSupport&&(e.novalidate?a(this).attr("novalidate","novalidate"):(f.each(function(){var a=this.getAttribute("type")+"",b=a.replace(/\W+$/,"");if(a!=b)try{this.type=b}catch(c){}}),e.hasTypeNormally=!0)),e.submitEnabled&&a(this).find(":disabled").each(function(){/^image|submit$/.test(this.type)&&a(this).removeAttr("disabled")}),a(this).bind("submit",function(){return a.html5Validate.isAllpass(f,e)&&e.validate()&&a.isFunction(b)&&b.call(this),!1}),a(this)}}(Zepto)}});